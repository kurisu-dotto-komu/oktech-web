---
import PageLayout from "../../layouts/PageLayout.astro";
import Section from "../../components/Section.astro";
import MemberDetails from "../../components/MemberDetails.astro";
import PrevNextButton from "../../components/PrevNextButton.astro";
import EventFeatured from "../../components/EventFeatured.astro";
import Link from "../../components/Link.astro";
import { getEvents, getMembers } from "../../data";

export async function getStaticPaths() {
  const members = await getMembers();
  return members.map((member) => ({
    params: { member: member.id },
  }));
}

const { member: memberId } = Astro.params;

const members = await getMembers();

const currentIndex = members.findIndex((m) => m.id === memberId);
const member = members[currentIndex];
const prevMember = currentIndex > 0 ? members[currentIndex - 1] : null;
const nextMember = currentIndex < members.length - 1 ? members[currentIndex + 1] : null;

const events = await getEvents();
const memberEvents = events.filter((event) =>
  member.events.find((e) => event.id.startsWith(`${e}`)),
);
---

<PageLayout title={`${member.name} - Community`}>
  <Section>
    <div class="flex justify-between items-center mb-8">
      <div class="flex gap-4">
        {
          prevMember && (
            <PrevNextButton
              url={`/member/${prevMember.id}`}
              title={prevMember.name}
              direction="prev"
            />
          )
        }
      </div>
      <div class="flex gap-4">
        {
          nextMember && (
            <PrevNextButton
              url={`/member/${nextMember.id}`}
              title={nextMember.name}
              direction="next"
            />
          )
        }
      </div>
    </div>
    <MemberDetails member={member} />
  </Section>
  {
    memberEvents.length > 0 && (
      <Section title="Events">
        <div class="flex flex-col gap-8 pt-8">
          {memberEvents.map((event) => (
            <EventFeatured event={event} />
          ))}
        </div>
      </Section>
    )
  }
</PageLayout>
